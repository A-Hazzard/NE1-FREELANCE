<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

        <script src="https://kit.fontawesome.com/18479e6558.js" crossorigin="anonymous"></script>
        {% load static %}
        
        {% block head %}<!--Block code used for django static referencing -->
        <link rel="stylesheet" href="{% static 'css/searchResults/search_results.css' %}"> 
        {% endblock %}
    
        <title>NE1-Freelance / Search Results for {{ search_term }}</title>
        
</head>
<body>

    <a href="{% url 'homePage' %}" class="btn btn-secondary">Home</a>


            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <h2>Search Results</h2>

                    <!--checks if there are any jobs found in the database -->
                    {% if jobs %}
                        <!-- If there are jobs found, displays the search term that was used -->
                        <p>Results for "{{ search_term }}"</p>
                        <!-- check if there is a corrected search term -->
                        {% if corrected_term %}
                            <!-- check if there is a "Did you mean?" suggestion -->
                            {% if did_you_mean == None %}
                                <!-- If there is no suggestion, do not suggest anything-->
                                <p></p>
                            {% endif %}


                        {% elif corrected_term and did_you_mean != None %}
                                <!-- If there is a suggestion, this text displays "Did you mean?" and a link to search for the suggested term -->
                                <p>{{ did_you_mean }} <a href="{% url 'search_jobs' %}?search={{ corrected_term }}" target="_blank">{{ corrected_term }}</a></p>
                        {% endif %}






                        <!-- check if user searched for anything -->
                        {% if search_term %}
                            <!-- If they did, allow the user to filter the search results by category -->

                            <form method="GET" action="{% url 'search_jobs' %}?query={{ search_term }}">
                                {% csrf_token %}
                                <input class="search" type="text" placeholder="Search for job..." name="search" required>
                                <select name="category">
                                    <option value="">All categories</option>
                                    {% for category in categories %}

                                        <!-- for each category in the categories table stored in the database, 
                                            create an option element with the category name as the value and text, 
                                            and if the category name matches the category_name variable, add the "selected" attribute -->
                                            
                                        <option value="{{ category.name }}" 
                                            {% if category.name == category_name %}
                                                selected
                                            {% endif %}
                                        >{{ category.name }}</option>
                                    {% endfor %}
                                </select>
                                <button type="submit">Filter</button>
                            </form>
                        {% endif %} <!--End the  if search_term  block-->
                        
                            <!-- flex-container for the job listing -->
                            <div class="job-list">
                                <!--For each job in the database, create a job card for them with a:
                                    1) Header
                                    2) Description
                                    3) Price
                                    4) Thumbnail (Coming soon)
                                -->
                                {% for job in jobs %}
                                    <!-- container for each job item -->
                                    <div class="job-card">
                                        <!-- display the job title -->
                                        <h3>{{ job.title }}</h3>
                                        <!-- display the job description -->
                                        <p>{{ job.description }}</p>
                                        <!-- display the job price -->
                                        <p>{{ job.price }}</p>
                                        <!-- display the job category -->
                                        <p>{{ job.category }}</p>
                                    </div>
                                {% endfor %}
                            </div>

                        {% else %} 


                        
                        <!-- This block is executed when there are no jobs found based on the search term -->
                        <p>No jobs found for: {{ search_term }}</p>

                            <!-- This block is executed when there's a corrected search term found  -->
                            {% if corrected_term %}
                            <p>{{ did_you_mean }} <a href="{% url 'search_jobs' %}?search={{ corrected_term }}" target="_blank">{{ corrected_term }}</a></p>
                            {% endif %}
                        

                                        <!-- This block is executed when there's a search term entered -->
                                        {% if search_term %}
                                            <form method="GET" action="{% url 'search_jobs' %}">
                                                {% csrf_token %}
                                                <input type="text" name="search" required>
                                                <select name="category">
                                                    <option value="">All categories</option>
                                                    {% for category in categories %}
                                                        <option value="{{ category.name }}" {% if category.name == category_name %}selected{% endif %}>{{ category.name }}</option>
                                                    {% endfor %}
                                                </select>
                                                <button type="submit">Filter</button>
                                            </form>
                                        {% endif %}





                    {% endif %}<!--End of  if jobs condition block-->
                                </div>
                            </div>
                        </div>
                        
</body>
</html>

